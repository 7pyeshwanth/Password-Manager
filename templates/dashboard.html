{% extends "base.html" %}

{% block style %}
<style>
  body {
    background-image: url("https://www.techtarget.com/rms/onlineimages/keys_a280346470.jpg");
    background-repeat: no-repeat;
    background-position: center center;
    background-attachment: fixed;
    background-size: cover;
  }

  .custom-container {
    color: white;
    background-color: rgba(0, 0, 0, 0.5);
    box-shadow: 0px 0px 20px -10px;
    border-radius: 1.5rem;
    margin: 1rem;
  }

  .custom-block {
    color: white;
    background-color: rgba(0, 0, 0);
    box-shadow: 0px 0px 20px -10px;
    border-radius: 1.5rem;
    margin: 1rem;
  }

  .custom-btn {
    margin: 0 10%;
    padding: 5%;
    padding-bottom: 0;
    background-color: rgb(202 215 206 / 0%);
    border: 0;
  }

  .table {
    --bs-table-hover-color: #ffffff;
  }
</style>
{% endblock %}

{% block body %}
{% csrf_token %}
<div class="container py-5">
  <div class="row" style="margin: 1rem;">
    <div class="col-lg-12 mx-auto rounded shadow p-0" style="background-color: #2a2645;">
      <div class="table-responsive">
        {% if passwords == "nothing" %}
        <div class="text-center text-white p-3">
          <h2>No Passwords Saved</h2>
        </div>
        {% else %}
        <table class="table table-fixed table-borderless table-hover text-white text-center " style="margin: 0;">
          <thead style="background-color: #23213b; height: 3rem;">
            <tr>
              <th scope="col" class="col-1">#</th>
              <th scope="col" class="col-3">Name</th>
              <th scope="col" class="col-6">Passwords</th>
              <th scope="col" class="col-2"></th>
            </tr>
          </thead>
          <tbody>
            {% for i in passwords %}
            <tr>
              <th scope="row" class="col-1">{{i.index}}</th>
              <td class="col-3"><span id="{{i.name}}">{{i.name}}</span></td>
              <td class="col-6"><span id="{{i.index}}">{{i.password}}</span></td>
              <td class="col-2" style="padding: 0;">
                <div class="d-flex">
                  <button class="custom-btn text-white" type="button" data-target="{{i.index}}"
                    onclick="copy(this.getAttribute('data-target'))">
                    <i class="material-icons">content_copy</i>
                  </button>
                  <button class="custom-btn text-white" type="button" data-target="{{i.name}}"
                    onclick="delete_item(this.getAttribute('data-target'))">
                    <i class="material-icons">delete</i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  copy = (element) => {
    navigator.clipboard.writeText(document.getElementById(element).innerHTML);
  }
  delete_item = (element) => {
    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        console.log("delete_item", element);
        $.ajax({
          type: "POST",
          url: "/requests",
          data: {
            type: "delete",
            name: element,
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
          },
          success: (data) => {
            if (data.ok == true) {
              Swal.fire({
                title: '<strong style="color:red;">Deleted!</strong>',
                icon: 'success',
                html:
                  "<b>" + element + "</b> has been deleted.",
                showCloseButton: true,
              }).then(()=>location.reload())
            }
          }
        })
      }
    })
  }
</script>
{% endblock %}